<mat-card>
  <mat-card-title>Cadastrar notas</mat-card-title>
  <mat-card-subtitle>Informe os dados da Nota fiscal</mat-card-subtitle>

  <mat-card-content>
    <form class="formulario" [formGroup]="formGroup">
      <div class="inputs">

        <mat-form-field class="example-full-width" appearance="outline">
          <mat-label>Lojas</mat-label>
          <input type="text" formControlName="loja" id="input-loja" placeholder="Selecione uma Loja" matInput
            [matAutocomplete]="auto">
          <mat-autocomplete autoActiveFirstOption #auto="matAutocomplete">
            <mat-option *ngFor="let loja of filtroLojas" [value]="loja.loja">
              {{loja.loja}}
            </mat-option>
          </mat-autocomplete>
          <mat-error *ngIf="formGroup.get('loja')?.hasError('required')">
            Informe uma <strong>Loja</strong>.
          </mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Data da Nota</mat-label>
          <input id="data-nf" matInput formControlName="dataNota" [matDatepicker]="picker" maxlength="10"
            >
          <!-- <mat-hint>DD/MM/AAAA</mat-hint> -->
          <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
          <mat-datepicker #picker></mat-datepicker>
          <mat-error *ngIf="formGroup.get('dataNota')?.errors ">
            {{getErrorMessage()}}
          </mat-error>
        </mat-form-field>

        <mat-form-field class="example-full-width" appearance="outline">
          <mat-label>Tipo de Despesa</mat-label>
          <input type="text" formControlName="despesa" placeholder="Selecione uma Despesa" matInput
            [matAutocomplete]="auto2">
          <mat-autocomplete autoActiveFirstOption #auto2="matAutocomplete">
            <mat-option *ngFor="let despesa of filtroDespesa " [value]="despesa.despesa">
              {{despesa.despesa}}
            </mat-option>
          </mat-autocomplete>
          <mat-error *ngIf="formGroup.get('loja')?.hasError('required')">
            Informe uma <strong>Despesa</strong>.
          </mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline">

          <span matPrefix>R$</span>
          <input class="input-valor" formControlName="valor" [(ngModel)]="valorDigitado" matInput placeholder="0.00"
            style="text-align: right;" (keyup)="formatarValor($event)">
          <mat-error *ngIf="formGroup.get('valor')?.hasError('required')">
            Informe um <strong>Valor</strong>.
          </mat-error>
        </mat-form-field>

      </div>

      <div class="btns">
        <button mat-button color="primary" [disabled]="!formGroup.valid" (click)="salvarNota()">Salvar</button>
      </div>
    </form>

    <mat-divider></mat-divider>

    <div class="titulo-tabela">
      <div>
        <mat-card-title>Lista de notas</mat-card-title>
        <mat-card-subtitle class="subtitle-lista">Quantidade de Notas: {{ dataSource.data.length }} | Total:
          {{ valorTotalNotas }}</mat-card-subtitle>
      </div>
      <button mat-raised-button color="primary" [disabled]="dataSource.data.length === 0" (click)="salvarLote()">Salvar
        Notas</button>
    </div>

    <div class="tabela-notas" *ngIf="dataSource.data.length !== 0">
      <table mat-table [dataSource]="dataSource" matSort (matSortChange)="announceSortChange($event)">

        <ng-container matColumnDef="#">
          <th mat-header-cell *matHeaderCellDef>#</th>
          <td mat-cell *matCellDef="let nota"> {{notas.indexOf(nota) + 1}} </td>
        </ng-container>

        <ng-container matColumnDef="loja">
          <th mat-header-cell *matHeaderCellDef mat-sort-header> LOJA </th>
          <td mat-cell *matCellDef="let nota"> {{nota.loja}} </td>
        </ng-container>

        <ng-container matColumnDef="dataNota">
          <th mat-header-cell *matHeaderCellDef mat-sort-header> DATA DA NOTA </th>
          <td mat-cell *matCellDef="let nota"> {{nota.dataNota | date: 'dd/MM/yyyy - EEEE'}} </td>
        </ng-container>

        <ng-container matColumnDef="despesa">
          <th mat-header-cell *matHeaderCellDef mat-sort-header> DESPESA </th>
          <td mat-cell *matCellDef="let nota"> {{nota.despesa}} </td>
        </ng-container>

        <ng-container matColumnDef="valor">
          <th mat-header-cell *matHeaderCellDef mat-sort-header> VALOR </th>
          <td mat-cell *matCellDef="let nota"> {{nota.valor | currency : 'BRL'}} </td>
        </ng-container>

        <ng-container matColumnDef="ACAO">
          <th mat-header-cell *matHeaderCellDef mat-sort-header></th>
          <td mat-cell *matCellDef="let nota">
            <button mat-icon-button class="btn-excluir-nota" color="warn" (click)="deletarNotaLista(nota)">
              <mat-icon>delete</mat-icon>
            </button>

          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="columnsToDisplay; sticky: true"></tr>
        <tr mat-row *matRowDef="let row; columns: columnsToDisplay;"></tr>
      </table>
    </div>

  </mat-card-content>




</mat-card>
